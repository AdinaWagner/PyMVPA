#!/usr/bin/make -f
# -*- mode: makefile; coding: utf-8 -*-

include /usr/share/cdbs/1/rules/debhelper.mk
DEB_PYTHON_SYSTEM = pysupport
DEB_PYTHON_MODULE_PACKAGE = python-mvpa
include /usr/share/cdbs/1/class/python-distutils.mk

# enable the LIBSVM wrapper
DEB_PYTHON_BUILD_ARGS += --with-libsvm
DEB_PYTHON_INSTALL_ARGS_ALL += --with-libsvm

clean::
	$(MAKE) distclean

build/python-mvpa::
ifeq (,$(filter nocheck,$(DEB_BUILD_OPTIONS)))
	MVPA_TESTS_LOWMEM=yes MVPA_TESTS_QUICK=yes MVPA_TESTS_LABILE=no \
		$(MAKE) unittest
endif

build/python-mvpa-doc::
	$(MAKE) doc

# use jquery from Debian package
# symlinked by debhelper
install/python-mvpa-doc::
	-rm build/html/_static/jquery.js

install/python-mvpa-data::
	# install the example data into the python-mvpa-data package
	mkdir -p debian/python-mvpa-data/usr/share/python-support/python-mvpa/mvpa
	cp -r mvpa/data \
		debian/python-mvpa-data/usr/share/python-support/python-mvpa/mvpa/

install/python-mvpa-lib::
	# move libraries into the python-mvpa-lib package
	mkdir -p debian/python-mvpa-lib/usr/
	mv debian/python-mvpa/usr/lib debian/python-mvpa-lib/usr/

# we need to move libraries away first, hence dependence on -lib
binary-install/python-mvpa:: install/python-mvpa-lib
	# remove the example data from the main package
	rm -r debian/python-mvpa/usr/share/python-support/python-mvpa/mvpa/data

binary-install/python-mvpa-lib::
	# assure that there is no mvpa module itself
	rm -rf debian/python-mvpa-lib/usr/share/python-support/python-mvpa-lib/mvpa/

# install directly into package directory (despite multiple packages)
DEB_DESTDIR = $(CURDIR)/debian/python-mvpa
# immediately useable documentation
# and exemplar data (they are small excerpts anyways)
DEB_COMPRESS_EXCLUDE := .py .pdf .html .css .jpg .txt .js .json .rtc .par .bin
# -doc package contents
DEB_INSTALL_DOCS_python-mvpa-doc := build/html build/latex/PyMVPA*.pdf
DEB_INSTALL_EXAMPLES_python-mvpa-doc := doc/examples/*

