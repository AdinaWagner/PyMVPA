From 72ca3bda22114017be49f4e605d6c205322d9090 Mon Sep 17 00:00:00 2001
From: "Nikolaas N. Oosterhof" <nikolaas.oosterhof@unitn.it>
Date: Sat, 24 Oct 2015 08:54:01 -0500
Subject: [PATCH] BF+TST: support testing NIML I/O on 32-bit platforms

---
 mvpa2/tests/test_surfing_afni.py | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/mvpa2/tests/test_surfing_afni.py b/mvpa2/tests/test_surfing_afni.py
index 1a7c0a7..06918a2 100644
--- a/mvpa2/tests/test_surfing_afni.py
+++ b/mvpa2/tests/test_surfing_afni.py
@@ -177,6 +177,8 @@ class SurfTests(unittest.TestCase):
 
         # test NIML I/O
         niml.write(fn, ds)
+
+        # remove extra fields added when reading the file
         ds2 = niml.from_any(fn)
         ds2.a.pop('history')
         ds2.a.pop('filename')
@@ -184,8 +186,10 @@ class SurfTests(unittest.TestCase):
         ds2.sa.pop('stats')
 
         # NIML does not support int64, only int32;
-        # stop this from making the test fail
-        ds2.samples = np.asarray(ds2.samples, dtype=np.int64)
+        # compare equality of values in samples by setting the
+        # datatype the same as in the input (int32 or int64 depending
+        # on the platform)
+        ds2.samples = np.asarray(ds2.samples, dtype=ds.samples.dtype)
         assert_datasets_equal(ds, ds2)
 
 
-- 
2.5.1

